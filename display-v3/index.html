<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sutan Raya - Flight Deck Operasional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sutan-blue': { '900': '#0A2342', '800': '#123458', '700': '#2C3E50' },
                        'sutan-gold': '#D4AF37'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans">

    <div id="app" class="flex h-screen bg-gray-100 text-gray-800">
        
        <nav class="w-64 bg-white flex-shrink-0 border-r border-gray-200 flex flex-col" :class="{ 'hidden': isFullscreen }">
            <div class="h-24 flex items-center justify-center border-b border-gray-200">
                <div class="brand text-4xl text-sutan-blue-900">SutanRaya</div>
            </div>
            <ul class="flex-grow p-4">
                <li @click="view = 'dashboard'" :class="view === 'dashboard' ? 'bg-sutan-blue-800 text-white shadow-md' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 tile"><i class="bi bi-window-split w-6 text-xl"></i><span class="ml-4 font-semibold">Dashboard</span></li>
                <li @click="view = 'inventaris'" :class="view === 'inventaris' ? 'bg-sutan-blue-800 text-white shadow-md' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 tile"><i class="bi bi-truck-front-fill w-6 text-xl"></i><span class="ml-4 font-semibold">Inventaris</span></li>
                <li @click="view = 'drivers'" :class="view === 'drivers' ? 'bg-sutan-blue-800 text-white shadow-md' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 tile"><i class="bi bi-person-badge-fill w-6 text-xl"></i><span class="ml-4 font-semibold">Kelola Supir</span></li>
                <li @click="view = 'history'" :class="view === 'history' ? 'bg-sutan-blue-800 text-white shadow-md' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 tile"><i class="bi bi-clock-history w-6 text-xl"></i><span class="ml-4 font-semibold">Riwayat</span></li>
                <li @click="view = 'display'" :class="view === 'display' ? 'bg-sutan-blue-800 text-white shadow-md' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 tile"><i class="bi bi-display-fill w-6 text-xl"></i><span class="ml-4 font-semibold">Layar Display</span></li>
                <li class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 hover:bg-gray-100 tile"><a href="process.html" class="flex items-center w-full"><i class="bi bi-plus-circle-dotted w-6 text-xl"></i><span class="ml-4 font-semibold">Proses</span></a></li>
                <li @click="view = 'admin'" :class="view === 'admin' ? 'bg-sutan-blue-800 text-white shadow-md' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200 mb-2 mt-8 border-t pt-4 tile"><i class="bi bi-sliders w-6 text-xl"></i><span class="ml-4 font-semibold">Panel Admin</span></li>
            </ul>
        </nav>

        <main class="flex-1 flex flex-col" :class="{ 'w-full h-full': isFullscreen }">
            <header class="h-24 bg-white border-b border-gray-200 flex-shrink-0 flex items-center justify-between px-8" :class="{ 'hidden': isFullscreen }">
                <h1 class="text-3xl font-bold text-sutan-blue-900">{{ currentViewTitle }}</h1>
                <div class="flex items-center gap-6">
                    <button v-if="view === 'display'" @click="toggleFullscreen" class="text-gray-500 hover:text-sutan-blue-800 text-2xl transition-transform duration-200 ease-in-out hover:scale-110 active:scale-95 tile"><i :class="isFullscreen ? 'bi-arrows-angle-contract' : 'bi-arrows-fullscreen'"></i></button>
                    <div class="text-right">
                        <div class="font-semibold text-gray-600">{{ currentDate }}</div>
                        <div class="text-2xl font-bold text-sutan-blue-900">{{ currentTime }}</div>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto bg-gray-100 relative" :class="isFullscreen ? 'p-0' : 'p-8'">
                <transition name="view" mode="out-in">
                    <component :is="view"></component>
                </transition>
            </div>
        </main>
        
        </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/event-handlers.js"></script>
    <script src="js/components.js"></script> <script src="js/app.js"></script>

    <script type="text/x-template" id="dashboard-view">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <div class="bg-white p-6 rounded-xl shadow-lg fade-slide-up">
                    <h2 class="text-2xl font-bold text-sutan-blue-900 mb-4 flex items-center"><i class="bi bi-box-arrow-up-right mr-3 text-sutan-gold"></i>Keberangkatan</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="text-xs text-gray-500 uppercase">
                                <tr class="border-b">
                                    <th class="p-3">Waktu</th>
                                    <th class="p-3">Tujuan</th>
                                    <th class="p-3">Armada</th>
                                    <th class="p-3">Supir</th>
                                    <th class="p-3">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="trip in departures" :key="trip.id" @click="openTripModal(trip)" class="border-b hover:bg-gray-50 cursor-pointer">
                                    <td class="p-3 font-semibold text-lg">{{ formatTime(trip.departureTime) }}</td>
                                    <td class="p-3 font-bold">{{ trip.destinationCode }}</td>
                                    <td class="p-3 text-sm text-gray-600">{{ trip.fleet.name }}</td>
                                    <td class="p-3 text-sm text-gray-600">{{ trip.driver.name }}</td>
                                    <td class="p-3"><span :class="statusClasses[trip.status]" class="px-2 py-1 rounded-full text-xs font-semibold">{{ trip.status }}</span></td>
                                </tr>
                                <tr v-if="departures.length === 0">
                                    <td colspan="5" class="p-8 text-center text-gray-400">Tidak ada jadwal keberangkatan aktif.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg fade-slide-up" style="animation-delay: 0.1s;">
                    <h2 class="text-2xl font-bold text-sutan-blue-900 mb-4 flex items-center"><i class="bi bi-box-arrow-in-down-left mr-3 text-sutan-gold"></i>Kedatangan</h2>
                     <div class="overflow-x-auto">
                        <table class="w-full text-left">
                           <thead class="text-xs text-gray-500 uppercase">
                                <tr class="border-b">
                                    <th class="p-3">ETA</th>
                                    <th class="p-3">Asal</th>
                                    <th class="p-3">Armada</th>
                                    <th class="p-3">Supir</th>
                                    <th class="p-3">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="trip in arrivals" :key="trip.id" @click="openTripModal(trip)" class="border-b hover:bg-gray-50 cursor-pointer">
                                    <td class="p-3 font-semibold text-lg">{{ formatTime(trip.arrivalTime) }}</td>
                                    <td class="p-3 font-bold">{{ trip.originCode }}</td>
                                    <td class="p-3 text-sm text-gray-600">{{ trip.fleet.name }}</td>
                                    <td class="p-3 text-sm text-gray-600">{{ trip.driver.name }}</td>
                                    <td class="p-3"><span :class="statusClasses[trip.status]" class="px-2 py-1 rounded-full text-xs font-semibold">{{ trip.status }}</span></td>
                                </tr>
                                <tr v-if="arrivals.length === 0">
                                    <td colspan="5" class="p-8 text-center text-gray-400">Tidak ada jadwal kedatangan aktif.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="space-y-8">
                <div class="bg-white p-6 rounded-xl shadow-lg fade-slide-up" style="animation-delay: 0.2s;">
                    <h2 class="text-2xl font-bold text-sutan-blue-900 mb-4 flex items-center"><i class="bi bi-stickies-fill mr-3 text-sutan-gold"></i>Rental Aktif</h2>
                    <div class="space-y-4 max-h-64 overflow-y-auto">
                        <div v-for="trip in rental" :key="trip.id" @click="openTripModal(trip)" class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                            <div class="flex justify-between items-center">
                                <span class="font-bold text-sutan-blue-800 truncate pr-2">{{ trip.notes }}</span>
                                <span class="text-xs font-semibold bg-purple-100 text-purple-800 px-2 py-1 rounded-full flex-shrink-0">Rental</span>
                            </div>
                            <p class="text-sm text-gray-600">{{ trip.fleet.name }}</p>
                            <div class="text-xs text-gray-500 mt-2">
                                <span>Berangkat: {{ formatDateTime(trip.departureTime) }}</span><br>
                                <span>Kembali: {{ formatDateTime(trip.arrivalTime) }}</span>
                            </div>
                        </div>
                        <div v-if="rental.length === 0" class="text-center text-gray-400 pt-8">
                            <p>Tidak ada armada yang sedang dirental.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg fade-slide-up" style="animation-delay: 0.3s;">
                    <h2 class="text-2xl font-bold text-sutan-blue-900 mb-4 flex items-center"><i class="bi bi-truck-front mr-3 text-sutan-gold"></i>Armada Standby</h2>
                    <button @click="openTripWizard()" class="w-full bg-sutan-gold text-sutan-blue-900 font-bold py-3 rounded-lg mb-4 hover:opacity-90 transition-opacity tile"><i class="bi bi-plus-circle-fill mr-2"></i>Buat Jadwal Baru</button>
                    <div class="space-y-2 max-h-64 overflow-y-auto">
                        <div v-for="armada in armadaStandby" :key="armada.id" @click="openTripWizard(armada.id)" class="flex items-center justify-between p-2 bg-green-50 rounded-lg cursor-pointer hover:bg-green-100 tile">
                            <div class="flex items-center">
                                <i :class="armada.icon" class="text-green-700 text-2xl mr-3"></i>
                                <div>
                                    <span class="font-semibold text-sm">{{ armada.name }}</span>
                                    <p class="text-xs text-gray-500">{{ armada.plate }}</p>
                                </div>
                            </div>
                            <i class="bi bi-chevron-right text-gray-400"></i>
                        </div>
                        <div v-if="armadaStandby.length === 0" class="text-center text-gray-400 pt-4">
                            <p>Semua armada sedang beroperasi.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>
    
    <script type="text/x-template" id="inventaris-view">
        <div class="fade-slide-up">
            <div class="mb-6 flex justify-between items-center">
                <div class="relative w-1/3">
                    <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" v-model="rootData.armadaSearchTerm" placeholder="Cari nama, plat, atau status armada..." class="w-full p-2 pl-10 border rounded-lg">
                </div>
                <button @click="rootMethods.openVehicleModal(null)" class="bg-sutan-blue-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-sutan-blue-700 transition-colors tile"><i class="bi bi-plus-lg mr-2"></i>Tambah Armada</button>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="text-xs text-gray-500 uppercase">
                            <tr class="border-b">
                                <th class="p-3">Nama Armada</th>
                                <th class="p-3">Tipe</th>
                                <th class="p-3">No. Polisi</th>
                                <th class="p-3">Kapasitas</th>
                                <th class="p-3">Status</th>
                                <th class="p-3">Jadwal Servis</th>
                                <th class="p-3">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="vehicle in rootData.filteredFleet" :key="vehicle.id" class="border-b hover:bg-gray-50">
                                <td class="p-3 font-semibold">{{ vehicle.name }}</td>
                                <td class="p-3">{{ vehicle.type }}</td>
                                <td class="p-3">{{ vehicle.plate }}</td>
                                <td class="p-3">{{ vehicle.capacity }} orang</td>
                                <td class="p-3"><span :class="getVehicleStatusClass(vehicle.status)" class="px-2 py-1 rounded-full text-xs font-semibold">{{ vehicle.status }}</span></td>
                                <td class="p-3">
                                    <span :class="{'text-red-500 font-bold': isServiceDue(vehicle.nextService, rootData.now)}">{{ formatFullDate(vehicle.nextService) }}</span>
                                </td>
                                <td class="p-3">
                                    <button @click="rootMethods.openVehicleModal(vehicle)" class="text-sutan-blue-800 hover:text-sutan-gold"><i class="bi bi-pencil-square"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </script>

    <script type="text/x-template" id="drivers-view">
        <div class="fade-slide-up">
            <div class="mb-6 flex justify-between items-center">
                <div class="relative w-1/3">
                     <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" v-model="rootData.driverSearchTerm" placeholder="Cari nama supir..." class="w-full p-2 pl-10 border rounded-lg">
                </div>
                <button @click="rootMethods.openDriverModal(null)" class="bg-sutan-blue-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-sutan-blue-700 transition-colors tile"><i class="bi bi-person-plus-fill mr-2"></i>Tambah Supir</button>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="text-xs text-gray-500 uppercase">
                            <tr class="border-b">
                                <th class="p-3">Nama Supir</th>
                                <th class="p-3">Jenis SIM</th>
                                <th class="p-3">No. Telepon</th>
                                <th class="p-3">Status</th>
                                <th class="p-3">Aksi</th>
                            </tr>
                        </thead>
                         <tbody>
                            <tr v-for="driver in rootData.filteredDrivers" :key="driver.id" class="border-b hover:bg-gray-50">
                                <td class="p-3 font-semibold">{{ driver.name }}</td>
                                <td class="p-3">{{ driver.licenseType }}</td>
                                <td class="p-3">{{ driver.phone }}</td>
                                <td class="p-3"><span :class="getDriverStatusClass(driver.status)" class="px-2 py-1 rounded-full text-xs font-semibold">{{ driver.status }}</span></td>
                                <td class="p-3">
                                    <button @click="rootMethods.openDriverModal(driver)" class="text-sutan-blue-800 hover:text-sutan-gold"><i class="bi bi-pencil-square"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </script>

    <script type="text/x-template" id="history-view">
        <div class="fade-slide-up">
            <div class="mb-6">
                 <div class="relative w-1/3">
                    <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" v-model="rootData.historySearchTerm" placeholder="Cari riwayat (armada, tujuan, notes)..." class="w-full p-2 pl-10 border rounded-lg">
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg">
                 <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="text-xs text-gray-500 uppercase">
                            <tr class="border-b">
                                <th class="p-3">Tanggal</th>
                                <th class="p-3">Armada</th>
                                <th class="p-3">Deskripsi Perjalanan</th>
                                <th class="p-3">Status Akhir</th>
                                <th class="p-3">Pendapatan</th>
                                <th class="p-3">Biaya</th>
                                <th class="p-3">Profit</th>
                            </tr>
                        </thead>
                         <tbody>
                            <tr v-for="trip in rootData.filteredHistory" :key="trip.id" class="border-b hover:bg-gray-50">
                                <td class="p-3">{{ formatFullDate(trip.departureTime) }}</td>
                                <td class="p-3 font-semibold">{{ trip.fleet.name }}</td>
                                <td class="p-3">
                                    <span v-if="trip.type === 'Rute'">Rute: {{ trip.origin }} -> {{ trip.destination }}</span>
                                    <span v-else>Rental: {{ trip.notes }}</span>
                                </td>
                                <td class="p-3"><span :class="statusClasses[trip.status]" class="px-2 py-1 rounded-full text-xs font-semibold">{{ trip.status }}</span></td>
                                <td class="p-3 text-green-600 font-semibold">{{ formatRupiah(trip.tripRevenue) }}</td>
                                <td class="p-3 text-red-600">({{ formatRupiah(trip.tripCost) }})</td>
                                <td class="p-3 font-bold" :class="trip.tripProfit > 0 ? 'text-blue-700' : 'text-gray-600'">{{ formatRupiah(trip.tripProfit) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </script>

    <script type="text/x-template" id="display-view">
        <div class="bg-sutan-blue-900 text-white h-full flex flex-col p-8" :class="{'fixed inset-0 z-50 p-4 sm:p-8': isFullscreen}">
            <header class="flex justify-between items-center pb-4 border-b-2 border-sutan-gold">
                <h1 class="text-4xl sm:text-6xl font-extrabold tracking-wider">SUTAN RAYA</h1>
                <div class="text-right">
                    <div class="text-xl sm:text-3xl font-bold">{{ currentTime }}</div>
                    <div class="text-base sm:text-xl">{{ currentDate }}</div>
                </div>
            </header>
            <main class="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 pt-8 overflow-y-auto">
                <div>
                    <h2 class="text-2xl sm:text-4xl font-bold text-sutan-gold mb-4 border-b border-sutan-gold pb-2">KEBERANGKATAN</h2>
                    <transition-group tag="div" name="list" class="space-y-4">
                         <div v-for="trip in rootData.upcomingDeparturesForDisplay" :key="trip.id" class="bg-sutan-blue-800 p-4 rounded-lg flex items-center shadow-lg">
                            <div class="w-24 text-center">
                                <div class="text-2xl sm:text-3xl font-bold">{{ formatTime(trip.departureTime) }}</div>
                            </div>
                            <div class="border-l-2 border-sutan-gold pl-4 flex-1">
                                <div class="text-xl sm:text-2xl font-semibold truncate">{{ trip.type === 'Rute' ? trip.destination : trip.notes }}</div>
                                <div class="text-base sm:text-lg text-gray-300">{{ trip.fleet.name }} - {{ trip.pax }}</div>
                            </div>
                            <div :class="statusClasses[trip.status]" class="px-3 py-1 rounded-full text-base sm:text-lg font-semibold ml-4 flex-shrink-0">{{ trip.status }}</div>
                        </div>
                    </transition-group>
                </div>
                <div>
                    <h2 class="text-2xl sm:text-4xl font-bold text-sutan-gold mb-4 border-b border-sutan-gold pb-2">KEDATANGAN</h2>
                    <transition-group tag="div" name="list" class="space-y-4">
                         <div v-for="trip in rootData.upcomingArrivalsForDisplay" :key="trip.id" class="bg-sutan-blue-800 p-4 rounded-lg flex items-center shadow-lg">
                            <div class="w-24 text-center">
                                <div class="text-2xl sm:text-3xl font-bold">{{ formatTime(trip.arrivalTime) }}</div>
                            </div>
                             <div class="border-l-2 border-sutan-gold pl-4 flex-1">
                                <div class="text-xl sm:text-2xl font-semibold truncate">{{ trip.origin }}</div>
                                <div class="text-base sm:text-lg text-gray-300">{{ trip.fleet.name }}</div>
                            </div>
                            <div :class="statusClasses[trip.status]" class="px-3 py-1 rounded-full text-base sm:text-lg font-semibold ml-4 flex-shrink-0">{{ trip.status }}</div>
                        </div>
                    </transition-group>
                </div>
            </main>
        </div>
    </script>
    
    <script type="text/x-template" id="admin-view">
        <div class="max-w-4xl mx-auto space-y-8 fade-slide-up">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-sutan-blue-900 mb-4 flex items-center"><i class="bi bi-cash-coin mr-3"></i>Manajemen Harga</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
                            <tr>
                                <th class="p-3">Armada</th>
                                <th class="p-3">Harga Sewa/Hari</th>
                                <th class="p-3">Harga/Orang (Rute)</th>
                                <th class="p-3">Biaya Operasional/Hari</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="armada in rootData.fleet" :key="armada.id" class="border-b">
                                <td class="p-3 font-semibold">{{ armada.name }}</td>
                                <td class="p-3"><input type="number" v-model.number="armada.hargaSewa" class="w-full p-2 border rounded-md"></td>
                                <td class="p-3"><input type="number" v-model.number="armada.hargaPerOrang" class="w-full p-2 border rounded-md"></td>
                                <td class="p-3"><input type="number" v-model.number="armada.biayaOperasional" class="w-full p-2 border rounded-md"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button @click="rootMethods.savePrices" class="mt-4 bg-sutan-gold text-sutan-blue-900 font-bold py-2 px-6 rounded-lg hover:opacity-90 transition-opacity tile">Simpan Perubahan</button>
                <p v-if="rootData.pricesSavedMessage" class="text-green-600 mt-2">{{ rootData.pricesSavedMessage }}</p>
            </div>
        </div>
    </script>
</body>
</html>