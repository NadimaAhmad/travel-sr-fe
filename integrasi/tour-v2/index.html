<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sutan Raya - Tour Management v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        /* Animasi untuk transisi antar langkah wizard */
        .step-enter-active, .step-leave-active {
            transition: all 0.3s ease-in-out;
        }
        .step-enter-from {
            opacity: 0;
            transform: translateX(20px);
        }
        .step-leave-to {
            opacity: 0;
            transform: translateX(-20px);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sutan-dark': '#121212',
                        'sutan-gold': '#D4AF37',
                        'sutan-light': '#f8f9fa',
                        'surface': '#1e1e1e',
                        'surface-bright': '#2a2a2a',
                        'border-color': '#444',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-sutan-dark text-sutan-light">

    <div id="tourApp">
        <div class="max-w-2xl mx-auto min-h-screen flex flex-col">
            <header class="p-6 text-center border-b border-b-sutan-gold/20 sticky top-0 bg-sutan-dark z-10">
                <a href="#" @click.prevent="returnToDashboard" class="text-2xl font-extrabold text-sutan-gold tracking-wider">SUTAN RAYA</a>
                <p class="text-sm text-white/70">Tour Management Panel</p>
            </header>

            <transition name="step" mode="out-in">
                <main class="flex-grow p-6" :key="currentStep">
                    <div v-if="currentStep === 'dashboard'">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-sutan-gold">Dashboard</h3>
                                <p class="text-white/70">Daftar Paket Tur</p>
                            </div>
                            <button @click="startPlanner" class="px-4 py-2 bg-sutan-gold text-sutan-dark font-bold rounded-lg flex items-center gap-2 hover:bg-yellow-500 transition-colors"><i class="bi bi-plus-lg"></i> Buat Paket</button>
                        </div>
                        <div v-if="savedTours.length === 0" class="text-center py-16 text-white/50">
                            <i class="bi bi-journal-x text-6xl"></i>
                            <p class="mt-4">Belum ada paket tur yang dibuat.</p>
                        </div>
                        <div v-else class="space-y-4">
                            <div v-for="(tour, index) in savedTours" :key="tour.id" @click="viewDetails(tour)" class="p-4 bg-surface rounded-lg border border-border-color cursor-pointer hover:border-sutan-gold transition-colors">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-bold">{{ tour.customerName || 'Paket Tanpa Nama' }}</h4>
                                        <p class="text-sm text-white/60"><i class="bi bi-people-fill"></i> {{ tour.pax }} Orang</p>
                                    </div>
                                    <span class="px-3 py-1 text-xs font-semibold rounded-full" :class="tour.type === 'Bermalam' ? 'bg-blue-500/20 text-blue-300' : 'bg-green-500/20 text-green-300'">{{ tour.type }}</span>
                                </div>
                                <div class="flex justify-between items-end text-sm mt-3 pt-3 border-t border-border-color">
                                    <div class="text-white/70">
                                        <div class="flex items-center gap-2"><i class="bi bi-calendar-event"></i> {{ calculatedDuration(tour) }} Hari</div>
                                        <div v-if="tour.budget > 0" class="flex items-center gap-2 mt-1"><i class="bi bi-wallet2"></i> Rp {{ tour.budget.toLocaleString('id-ID') }}/pax</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-lg text-sutan-gold">Rp {{ calculateTotalPrice(tour).toLocaleString('id-ID') }}</div>
                                        <button @click.stop="deleteTour(index)" class="text-red-400 hover:text-red-300 text-xs mt-1">Hapus</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentStep === 'details' && selectedTour">
                         <h3 class="text-2xl font-bold text-sutan-gold">Detail Paket Tur</h3>
                        <p class="text-white/70 mb-6">Ringkasan lengkap untuk <strong class="text-sutan-gold">{{ selectedTour.customerName }}</strong>.</p>
                        <div class="p-4 rounded-lg bg-surface space-y-3">
                            <div class="flex justify-between py-2 border-b border-border-color"><span class="text-white/60">Nama Klien</span><strong class="text-right">{{ selectedTour.customerName }} ({{ selectedTour.pax }} Orang)</strong></div>
                            <div class="flex justify-between py-2 border-b border-border-color"><span class="text-white/60">Tanggal & Tipe</span><strong class="text-right">{{ formatDate(selectedTour.startDate) }} - {{ formatDate(selectedTour.endDate) }} ({{ selectedTour.type }})</strong></div>
                            <div class="flex justify-between py-2 border-b border-border-color"><span class="text-white/60">Titik Jemput</span><strong class="text-right">{{ selectedTour.pickupPoint }}</strong></div>
                            <div class="flex justify-between py-2 border-b border-border-color"><span class="text-white/60">Transportasi</span><strong class="text-right">{{ selectedTour.vehicle }}</strong></div>
                            <div v-if="selectedTour.destinations.length > 0" class="py-2 border-b border-border-color"><span class="text-white/60 mb-2 block">Destinasi</span><div class="flex flex-wrap gap-2 justify-end"><span v-for="d in selectedTour.destinations" class="px-2 py-1 bg-surface-bright text-xs rounded">{{ d.name }}</span></div></div>
                        </div>
                        <div class="mt-6">
                            <h4 class="font-bold text-lg text-white/90 mb-2">Rincian Biaya</h4>
                             <div class="p-4 rounded-lg bg-surface space-y-3">
                                <div v-for="(value, key) in getPriceBreakdown(selectedTour)" v-if="value > 0" class="flex justify-between py-2 border-b border-border-color text-sm"><span class="text-white/60">{{ key }}</span><strong>Rp {{ value.toLocaleString('id-ID') }}</strong></div>
                                <div class="flex justify-between py-2"><span class="text-sutan-gold font-bold">Total Estimasi</span><strong class="text-sutan-gold text-lg">Rp {{ calculateTotalPrice(selectedTour).toLocaleString('id-ID') }}</strong></div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-3 mt-8">
                            <button @click="editTour(selectedTour)" class="w-full px-4 py-3 bg-sutan-gold text-sutan-dark font-bold rounded-lg flex items-center justify-center gap-2 hover:bg-yellow-500 transition-colors"><i class="bi bi-pencil-square"></i> Edit Paket Ini</button>
                            <button @click="returnToDashboard" class="w-full px-4 py-3 bg-transparent text-sutan-gold font-semibold rounded-lg hover:bg-white/10 transition-colors">Kembali ke Dashboard</button>
                        </div>
                    </div>
                    
                    <template v-if="currentStep.startsWith('step')">
                        <div v-if="currentStep === 'step1'">
                            <h3 class="text-2xl font-bold text-sutan-gold">{{ isEditing ? 'Edit Info Klien' : 'Langkah 1: Info Klien' }}</h3>
                            <p class="text-white/70 mb-6">Data pelanggan, jumlah peserta, dan anggaran.</p>
                            <div class="space-y-4">
                                <div><label class="block mb-1 text-sm font-medium text-white/80">Nama Pelanggan / Grup</label><input type="text" v-model="trip.customerName" placeholder="Contoh: Keluarga Bpk. Ahmad" class="w-full p-3 bg-surface border border-border-color rounded-lg focus:ring-2 focus:ring-sutan-gold focus:border-sutan-gold outline-none"></div>
                                <div><label class="block mb-1 text-sm font-medium text-white/80">Jumlah Orang</label><input type="number" v-model.number="trip.pax" min="1" class="w-full p-3 bg-surface border border-border-color rounded-lg focus:ring-2 focus:ring-sutan-gold focus:border-sutan-gold outline-none"></div>
                            </div>
                        </div>
                        
                        <div v-if="currentStep === 'step2'">
                            <h3 class="text-2xl font-bold text-sutan-gold">{{ isEditing ? 'Edit Tanggal & Tipe' : 'Langkah 2: Tanggal & Tipe' }}</h3>
                            <p class="text-white/70 mb-6">Pilih tanggal dan tipe perjalanan.</p>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div><label class="block mb-1 text-sm font-medium text-white/80">Tanggal Mulai</label><input type="date" v-model="trip.startDate" class="w-full p-3 bg-surface border border-border-color rounded-lg focus:ring-2 focus:ring-sutan-gold focus:border-sutan-gold outline-none"></div>
                                <div><label class="block mb-1 text-sm font-medium text-white/80">Tanggal Selesai</label><input type="date" v-model="trip.endDate" class="w-full p-3 bg-surface border border-border-color rounded-lg focus:ring-2 focus:ring-sutan-gold focus:border-sutan-gold outline-none"></div>
                            </div>
                            <div class="flex gap-2 p-1 bg-surface rounded-lg mb-4">
                                <button @click="trip.type = 'Bermalam'" class="w-full py-2 rounded-md font-semibold text-sm transition-colors" :class="trip.type === 'Bermalam' ? 'bg-sutan-gold text-sutan-dark' : 'text-white/60 hover:bg-white/10'">Bermalam</button>
                                <button @click="trip.type = 'Harian'" class="w-full py-2 rounded-md font-semibold text-sm transition-colors" :class="trip.type === 'Harian' ? 'bg-sutan-gold text-sutan-dark' : 'text-white/60 hover:bg-white/10'">Harian</button>
                            </div>
                            <div v-if="calculatedDuration(trip) > 0" class="p-3 bg-blue-500/10 text-blue-300 text-center rounded-lg">Durasi: <strong>{{ calculatedDuration(trip) }} hari</strong></div>
                        </div>

                        <div v-if="currentStep === 'step3'">
                            <h3 class="text-2xl font-bold text-sutan-gold">{{ isEditing ? 'Edit Rute' : 'Langkah 3: Tentukan Rute' }}</h3>
                            <p class="text-white/70 mb-6">Pilih kota asal, tujuan, dan armada.</p>
                             <div v-if="trip.route.length > 0" class="mb-4 space-y-2">
                                <div v-for="(r, index) in trip.route" class="p-2 bg-surface-bright rounded-md flex justify-between items-center text-sm"><span>{{ index + 1 }}. {{ r.from }} → {{ r.to }}</span><button @click="removeRoute(index)" class="text-red-400 hover:text-red-300"><i class="bi bi-trash"></i></button></div>
                            </div>
                            <div class="border border-border-color rounded-lg p-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block mb-1 text-sm font-medium text-white/80">Dari</label><input type="text" v-model="newRoute.from" readonly class="w-full p-3 bg-surface border border-border-color rounded-lg"></div>
                                    <div><label class="block mb-1 text-sm font-medium text-white/80">Ke</label><select v-model="newRoute.to" class="w-full p-3 bg-surface border border-border-color rounded-lg"><option disabled value="">Pilih Tujuan</option><option v-for="city in availableCities">{{ city }}</option></select></div>
                                </div>
                                <button @click="addRoute" :disabled="!newRoute.to" class="mt-3 w-full p-2 bg-sutan-gold/20 text-sutan-gold font-semibold rounded-lg hover:bg-sutan-gold/30 disabled:bg-gray-700 disabled:text-gray-500 transition-colors">Tambah Rute</button>
                            </div>
                        </div>

                        <div v-if="currentStep === 'step4'">
                             <h3 class="text-2xl font-bold text-sutan-gold">{{ isEditing ? 'Edit Kendaraan & Jemput' : 'Langkah 4: Kendaraan & Jemput' }}</h3>
                            <p class="text-white/70 mb-6">Pilih armada dan titik penjemputan.</p>
                             <div class="space-y-3 mb-6">
                                <div v-for="vehicle in vehicles" @click="trip.vehicle = vehicle.name" class="p-4 border rounded-lg cursor-pointer flex items-center gap-4 transition-colors" :class="trip.vehicle === vehicle.name ? 'border-sutan-gold bg-sutan-gold/10' : 'border-border-color hover:bg-white/5'">
                                    <i :class="vehicle.icon" class="text-3xl text-sutan-gold"></i>
                                    <div><h5 class="font-bold">{{ vehicle.name }}</h5><p class="text-sm text-white/60 mb-0">{{ vehicle.capacity }}</p></div>
                                </div>
                            </div>
                             <div><label class="block mb-1 text-sm font-medium text-white/80">Alamat / Titik Jemput</label><textarea v-model="trip.pickupPoint" rows="3" placeholder="Contoh: Depan Hotel Santika Padang" class="w-full p-3 bg-surface border border-border-color rounded-lg focus:ring-2 focus:ring-sutan-gold focus:border-sutan-gold outline-none"></textarea></div>
                        </div>

                        <div v-if="currentStep === 'step5'">
                             <h3 class="text-2xl font-bold text-sutan-gold">{{ isEditing ? 'Edit Destinasi & Layanan' : 'Langkah 5: Destinasi & Layanan' }}</h3>
                            <p class="text-white/70 mb-6">Pilih destinasi wisata dan layanan tambahan.</p>
                            <div class="space-y-4">
                                <div v-for="city in routeCities">
                                    <h4 class="font-bold text-white/90 mt-2 mb-2 border-b border-border-color pb-1">{{ city }}</h4>
                                    <div class="space-y-2">
                                        <label v-for="dest in destinationsByCity(city)" class="flex items-center p-3 bg-surface rounded-lg hover:bg-surface-bright"><input type="checkbox" :value="dest" v-model="trip.destinations" class="w-4 h-4 rounded bg-surface-bright border-border-color text-sutan-gold focus:ring-sutan-gold"><span class="ml-3 text-sm">{{ dest.name }}</span></label>
                                    </div>
                                </div>
                                <div class="pt-4 border-t border-border-color">
                                    <label class="flex items-center p-3 bg-surface rounded-lg hover:bg-surface-bright"><input type="checkbox" v-model="trip.addons.documentation" class="w-4 h-4 rounded bg-surface-bright border-border-color text-sutan-gold focus:ring-sutan-gold"><span class="ml-3 text-sm font-semibold">Dokumentasi (Foto & Video Drone)</span></label>
                                    <label class="flex items-center p-3 bg-surface rounded-lg hover:bg-surface-bright mt-2"><input type="checkbox" v-model="trip.addons.outbound" class="w-4 h-4 rounded bg-surface-bright border-border-color text-sutan-gold focus:ring-sutan-gold"><span class="ml-3 text-sm font-semibold">Aktivitas Outbound</span></label>
                                </div>
                            </div>
                        </div>
                    </template>

                    <div v-if="currentStep.startsWith('step')" class="mt-8 flex gap-3">
                        <button v-if="currentStep !== 'step1'" @click="prevStep" class="w-1/3 px-4 py-3 bg-surface-bright text-white font-semibold rounded-lg hover:bg-white/20 transition-colors">Kembali</button>
                        <button v-if="currentStep !== 'step5'" @click="nextStep" :disabled="!isStepValid(currentStep)" class="flex-grow px-4 py-3 bg-sutan-gold text-sutan-dark font-bold rounded-lg hover:bg-yellow-500 disabled:bg-gray-600 disabled:text-gray-400 transition-colors">Lanjut</button>
                        <button v-if="currentStep === 'step5'" @click="saveTour" class="flex-grow px-4 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-500 transition-colors">{{ isEditing ? 'Update Paket' : 'Simpan Paket' }}</button>
                    </div>
                </main>
            </transition>
        </div>
    </div>

    <script src="../tour.js"></script>
</body>
</html>